<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EcoBloom Farm Monitor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @keyframes pulse-slow {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    .pulse-alert { animation: pulse-slow 2s infinite; }
    
    @keyframes slide-in {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .slide-in { animation: slide-in 0.5s ease-out; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 p-4 md:p-8">

  <div class="max-w-7xl mx-auto" id="dashboard">
    <!-- Header -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 flex flex-col md:flex-row justify-between items-start md:items-center">
      <div>
        <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
          🌱 <span data-i18n="title">EcoBloom Farm Monitor</span>
        </h1>
        <p class="text-gray-600 mt-1" data-i18n="subtitle">Mohammed's Greenhouse - Al Rayyan</p>
      </div>
      <div class="flex gap-3 mt-4 md:mt-0">
        <!-- Language Switcher -->
        <div class="flex gap-2 bg-gray-100 rounded-xl p-1">
          <button onclick="switchLanguage('en')" id="lang-en" class="px-4 py-2 rounded-lg font-semibold transition-all bg-white shadow-md">
            EN
          </button>
          <button onclick="switchLanguage('ar')" id="lang-ar" class="px-4 py-2 rounded-lg font-semibold transition-all hover:bg-white">
            عربي
          </button>
          <button onclick="switchLanguage('hi')" id="lang-hi" class="px-4 py-2 rounded-lg font-semibold transition-all hover:bg-white">
            हिंदी
          </button>
        </div>
        <!-- Time Display -->
        <div class="text-right bg-gray-50 rounded-xl px-4 py-2">
          <div class="text-sm text-gray-500" data-i18n="lastUpdated">Last Updated</div>
          <div id="time" class="text-lg font-semibold text-gray-700"></div>
        </div>
      </div>
    </div>

    <!-- Risk Banner -->
    <div id="riskBanner" class="rounded-2xl p-6 mb-6 border-2 flex items-center gap-4 slide-in">
      <div class="text-5xl" id="riskIcon">⚠️</div>
      <div class="flex-1">
        <h2 id="riskLevel" class="text-3xl font-bold"></h2>
        <p id="riskText" class="text-gray-700 mt-1 text-lg"></p>
        <div class="mt-3">
          <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
            <div id="riskBar" class="h-3 rounded-full transition-all duration-1000"></div>
          </div>
        </div>
      </div>
      <button id="riskButton" class="px-6 py-3 rounded-xl font-semibold text-white hover:scale-105 transition-transform" data-i18n="viewActions">
        View Actions
      </button>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
      <!-- Pest Card -->
      <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-2xl transition-shadow">
        <div class="flex justify-between mb-3">
          <span class="text-4xl">🦟</span>
          <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-bold" data-i18n="bug">Bug</span>
        </div>
        <h3 class="text-sm text-gray-600 mb-2" data-i18n="pestsDetected">Pests Detected</h3>
        <p id="pestCount" class="text-5xl font-bold text-gray-800 mb-2">14</p>
        <div class="flex items-center gap-2">
          <span class="text-red-600 text-sm font-semibold">↑ +75%</span>
          <span class="text-gray-500 text-xs" data-i18n="sinceYesterday">since yesterday</span>
        </div>
      </div>

      <!-- Temperature Card -->
      <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-2xl transition-shadow">
        <div class="flex justify-between mb-3">
          <span class="text-4xl">🌡️</span>
          <span class="bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-xs font-bold" data-i18n="temp">Temp</span>
        </div>
        <h3 class="text-sm text-gray-600 mb-2" data-i18n="temperature">Temperature</h3>
        <p class="text-5xl font-bold text-gray-800 mb-2">28°C</p>
        <div class="flex items-center gap-2">
          <span class="text-orange-600 text-sm font-semibold" data-i18n="peak">Peak: 38°C</span>
          <span class="text-gray-500 text-xs">@ 6PM</span>
        </div>
      </div>

      <!-- Humidity Card -->
      <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-2xl transition-shadow">
        <div class="flex justify-between mb-3">
          <span class="text-4xl">💧</span>
          <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold" data-i18n="humid">Humid</span>
        </div>
        <h3 class="text-sm text-gray-600 mb-2" data-i18n="humidity">Humidity</h3>
        <p class="text-5xl font-bold text-gray-800 mb-2">67%</p>
        <div class="text-blue-600 text-sm font-semibold" data-i18n="optimalPests">Optimal for whiteflies</div>
      </div>

      <!-- Neighbor Alerts Card -->
      <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-2xl transition-shadow">
        <div class="flex justify-between mb-3">
          <span class="text-4xl">🤝</span>
          <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-bold" data-i18n="alerts">Alerts</span>
        </div>
        <h3 class="text-sm text-gray-600 mb-2" data-i18n="neighborAlerts">Neighbor Alerts</h3>
        <p class="text-5xl font-bold text-gray-800 mb-2">2</p>
        <div class="text-purple-600 text-sm font-semibold" data-i18n="nearbyReporting">Nearby farms reporting</div>
      </div>
    </div>

    <!-- Action Recommendations Panel -->
    <div class="bg-gradient-to-r from-red-50 to-orange-50 border-2 border-red-300 rounded-2xl shadow-lg p-6 mb-6 pulse-alert">
      <h2 class="text-2xl font-bold text-red-800 mb-4 flex items-center gap-3">
        🚨 <span data-i18n="urgentActions">URGENT ACTIONS REQUIRED</span>
      </h2>
      <div class="space-y-3">
        <div class="bg-white rounded-xl p-4 flex items-start gap-3">
          <span class="text-2xl">1️⃣</span>
          <div>
            <h3 class="font-bold text-gray-800" data-i18n="action1Title">Apply Neem Oil Spray</h3>
            <p class="text-gray-600 text-sm" data-i18n="action1Desc">Within 24 hours - Target infected areas</p>
          </div>
        </div>
        <div class="bg-white rounded-xl p-4 flex items-start gap-3">
          <span class="text-2xl">2️⃣</span>
          <div>
            <h3 class="font-bold text-gray-800" data-i18n="action2Title">Increase Ventilation</h3>
            <p class="text-gray-600 text-sm" data-i18n="action2Desc">Reduce humidity below 60% to slow pest reproduction</p>
          </div>
        </div>
        <div class="bg-white rounded-xl p-4 flex items-start gap-3">
          <span class="text-2xl">3️⃣</span>
          <div>
            <h3 class="font-bold text-gray-800" data-i18n="action3Title">Remove Infested Leaves</h3>
            <p class="text-gray-600 text-sm" data-i18n="action3Desc">Dispose properly to prevent spread</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <!-- Pest Chart -->
      <div class="bg-white rounded-2xl shadow-lg p-6">
        <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
          📈 <span data-i18n="pestPopulation">7-Day Pest Population</span>
        </h2>
        <canvas id="pestChart"></canvas>
        <div class="mt-4 p-3 bg-red-50 rounded-lg">
          <p class="text-sm text-red-800 font-semibold" data-i18n="pestTrend">
            Exponential growth detected - Immediate intervention needed
          </p>
        </div>
      </div>

      <!-- Heat Chart -->
      <div class="bg-white rounded-2xl shadow-lg p-6">
        <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
          🌡️ <span data-i18n="heatForecast">Heat Stress Forecast</span>
        </h2>
        <canvas id="heatChart"></canvas>
        <div class="mt-4 p-3 bg-orange-50 rounded-lg">
          <p class="text-sm text-orange-800 font-semibold" data-i18n="heatWarning">
            Deploy shade cloth before 2 PM today
          </p>
        </div>
      </div>
    </div>

    <!-- Community Feed -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
      <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
        💬 <span data-i18n="communityFeed">Community Feed</span>
      </h2>
      <div class="space-y-3">
        <div class="flex items-start gap-3 p-3 bg-purple-50 rounded-lg">
          <div class="w-10 h-10 bg-purple-200 rounded-full flex items-center justify-center text-xl">👨‍🌾</div>
          <div class="flex-1">
            <p class="font-semibold text-gray-800" data-i18n="farmB">Farm B (1.2km away)</p>
            <p class="text-sm text-gray-600" data-i18n="farmBMessage">HIGH pest alert - Whiteflies detected</p>
            <p class="text-xs text-gray-400">15 minutes ago</p>
          </div>
        </div>
        <div class="flex items-start gap-3 p-3 bg-blue-50 rounded-lg">
          <div class="w-10 h-10 bg-blue-200 rounded-full flex items-center justify-center text-xl">👨‍🌾</div>
          <div class="flex-1">
            <p class="font-semibold text-gray-800" data-i18n="farmC">Farm C (2.8km away)</p>
            <p class="text-sm text-gray-600" data-i18n="farmCMessage">Neem oil application successful - 70% reduction in 3 days</p>
            <p class="text-xs text-gray-400">2 hours ago</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Embedded system pages -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
      <h2 class="text-xl font-bold mb-4">🔗 Integrated Pages</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="col-span-1">
          <div class="flex justify-between items-center mb-2">
            <h3 class="font-semibold">P2P Network</h3>
            <div class="flex gap-2">
              <button class="px-2 py-1 rounded-lg bg-green-100 text-green-800 text-sm" onclick="openInModal('/p2p')">Expand</button>
              <a class="px-2 py-1 rounded-lg bg-gray-100 text-gray-800 text-sm" href="/p2p" target="_blank" rel="noopener">Open</a>
            </div>
          </div>
          <iframe id="iframe-p2p" src="/p2p" class="w-full h-64 rounded-lg border" title="P2P Network"></iframe>
        </div>
        <div class="col-span-1">
          <div class="flex justify-between items-center mb-2">
            <h3 class="font-semibold">Pest Detection</h3>
            <div class="flex gap-2">
              <button class="px-2 py-1 rounded-lg bg-green-100 text-green-800 text-sm" onclick="openInModal('/pest')">Expand</button>
              <a class="px-2 py-1 rounded-lg bg-gray-100 text-gray-800 text-sm" href="/pest" target="_blank" rel="noopener">Open</a>
            </div>
          </div>
          <iframe id="iframe-pest" src="/pest" class="w-full h-64 rounded-lg border" title="Pest Detection"></iframe>
        </div>
        <div class="col-span-1">
          <div class="flex justify-between items-center mb-2">
            <h3 class="font-semibold">Heat Stress</h3>
            <div class="flex gap-2">
              <button class="px-2 py-1 rounded-lg bg-green-100 text-green-800 text-sm" onclick="openInModal('/heat')">Expand</button>
              <a class="px-2 py-1 rounded-lg bg-gray-100 text-gray-800 text-sm" href="/heat" target="_blank" rel="noopener">Open</a>
            </div>
          </div>
          <iframe id="iframe-heat" src="/heat" class="w-full h-64 rounded-lg border" title="Heat Stress"></iframe>
        </div>
      </div>
    </div>

    <!-- Fullscreen modal for embedded pages -->
    <div id="embedModal" class="fixed inset-0 hidden items-center justify-center bg-black bg-opacity-60 z-50">
      <div class="bg-white rounded-2xl w-11/12 h-5/6 shadow-lg overflow-hidden flex flex-col">
        <div class="p-3 flex justify-between items-center border-b">
          <div id="modalTitle" class="font-bold">Embedded Page</div>
          <div class="flex gap-2">
            <a id="openNewTab" class="px-3 py-1 rounded-lg bg-gray-100 text-gray-800 text-sm" href="#" target="_blank">Open in new tab</a>
            <button class="px-3 py-1 rounded-lg bg-red-500 text-white" onclick="closeModal()">Close</button>
          </div>
        </div>
        <iframe id="modalIframe" src="" class="flex-1 w-full" frameborder="0"></iframe>
      </div>
    </div>

    <!-- Footer -->
    <div class="text-center text-sm text-gray-600 mt-6 space-y-2">
      <div>
        📡 <span data-i18n="systemStatus">System Status</span>: 
        <span class="text-green-600 font-semibold" data-i18n="online">Online</span> | 
        <span data-i18n="connected">Connected to</span> <span id="connectedPeers" class="font-semibold">-</span> <span data-i18n="peers">peers</span>
      </div>
      <div data-i18n="poweredBy">Powered by EcoBloom - Open Source Agricultural Intelligence</div>
    </div>
  </div>

  <script>
    // Translations
    const translations = {
      en: {
        title: "EcoBloom Farm Monitor",
        subtitle: "Mohammed's Greenhouse - Al Rayyan",
        lastUpdated: "Last Updated",
        viewActions: "View Actions",
        bug: "Bug",
        pestsDetected: "Pests Detected",
        sinceYesterday: "since yesterday",
        temp: "Temp",
        temperature: "Temperature",
        peak: "Peak: 38°C",
        humid: "Humid",
        humidity: "Humidity",
        optimalPests: "Optimal for whiteflies",
        alerts: "Alerts",
        neighborAlerts: "Neighbor Alerts",
        nearbyReporting: "Nearby farms reporting",
        urgentActions: "URGENT ACTIONS REQUIRED",
        action1Title: "Apply Neem Oil Spray",
        action1Desc: "Within 24 hours - Target infected areas",
        action2Title: "Increase Ventilation",
        action2Desc: "Reduce humidity below 60% to slow pest reproduction",
        action3Title: "Remove Infested Leaves",
        action3Desc: "Dispose properly to prevent spread",
        pestPopulation: "7-Day Pest Population",
        pestTrend: "Exponential growth detected - Immediate intervention needed",
        heatForecast: "Heat Stress Forecast",
        heatWarning: "Deploy shade cloth before 2 PM today",
        communityFeed: "Community Feed",
        farmB: "Farm B (1.2km away)",
        farmBMessage: "HIGH pest alert - Whiteflies detected",
        farmC: "Farm C (2.8km away)",
        farmCMessage: "Neem oil application successful - 70% reduction in 3 days",
        systemStatus: "System Status",
        online: "Online",
        connected: "Connected to",
        peers: "peers",
        poweredBy: "Powered by EcoBloom - Open Source Agricultural Intelligence",
        riskHigh: "HIGH RISK",
        riskMedium: "MEDIUM RISK",
        riskLow: "LOW RISK",
        riskTextHigh: "Risk Score: 78/100 - Immediate action required",
        riskTextMedium: "Risk Score: 45/100 - Monitor closely",
        riskTextLow: "Risk Score: 20/100 - Continue normal operations"
      },
      ar: {
        title: "مراقب مزرعة إيكو بلوم",
        subtitle: "دفيئة محمد - الريان",
        lastUpdated: "آخر تحديث",
        viewActions: "عرض الإجراءات",
        bug: "حشرة",
        pestsDetected: "الآفات المكتشفة",
        sinceYesterday: "منذ الأمس",
        temp: "درجة",
        temperature: "درجة الحرارة",
        peak: "الذروة: 38°م",
        humid: "رطوبة",
        humidity: "الرطوبة",
        optimalPests: "مثالي للذباب الأبيض",
        alerts: "تنبيهات",
        neighborAlerts: "تنبيهات الجيران",
        nearbyReporting: "المزارع المجاورة تبلغ",
        urgentActions: "إجراءات عاجلة مطلوبة",
        action1Title: "رش زيت النيم",
        action1Desc: "في غضون 24 ساعة - استهدف المناطق المصابة",
        action2Title: "زيادة التهوية",
        action2Desc: "تقليل الرطوبة إلى أقل من 60٪",
        action3Title: "إزالة الأوراق المصابة",
        action3Desc: "التخلص منها بشكل صحيح لمنع الانتشار",
        pestPopulation: "عدد الآفات لمدة 7 أيام",
        pestTrend: "تم اكتشاف نمو أسي - التدخل الفوري مطلوب",
        heatForecast: "توقعات الإجهاد الحراري",
        heatWarning: "نشر قماش الظل قبل الساعة 2 ظهرًا اليوم",
        communityFeed: "موجز المجتمع",
        farmB: "المزرعة ب (1.2 كم)",
        farmBMessage: "تنبيه آفات عالي - ذباب أبيض",
        farmC: "المزرعة ج (2.8 كم)",
        farmCMessage: "زيت النيم ناجح - انخفاض 70٪",
        systemStatus: "حالة النظام",
        online: "متصل",
        connected: "متصل بـ",
        peers: "أقران",
        poweredBy: "مدعوم من إيكو بلوم",
        riskHigh: "خطر عالي",
        riskMedium: "خطر متوسط",
        riskLow: "خطر منخفض",
        riskTextHigh: "درجة الخطر: 78/100 - إجراء فوري",
        riskTextMedium: "درجة الخطر: 45/100 - راقب",
        riskTextLow: "درجة الخطر: 20/100 - عادي"
      },
      hi: {
        title: "इको ब्लूम फार्म मॉनिटर",
        subtitle: "मोहम्मद का ग्रीनहाउस - अल रय्यान",
        lastUpdated: "अंतिम अपडेट",
        viewActions: "कार्रवाई देखें",
        bug: "कीट",
        pestsDetected: "कीट पाए गए",
        sinceYesterday: "कल से",
        temp: "तापमान",
        temperature: "तापमान",
        peak: "चरम: 38°C",
        humid: "आर्द्रता",
        humidity: "आर्द्रता",
        optimalPests: "सफेद मक्खियों के लिए",
        alerts: "अलर्ट",
        neighborAlerts: "पड़ोसी अलर्ट",
        nearbyReporting: "पास के खेत",
        urgentActions: "तत्काल कार्रवाई",
        action1Title: "नीम तेल स्प्रे करें",
        action1Desc: "24 घंटे में - संक्रमित क्षेत्र",
        action2Title: "हवादार बढ़ाएं",
        action2Desc: "आर्द्रता 60% से कम",
        action3Title: "पत्तियां हटाएं",
        action3Desc: "ठीक से निपटान करें",
        pestPopulation: "7-दिन कीट संख्या",
        pestTrend: "तेजी से वृद्धि - हस्तक्षेप चाहिए",
        heatForecast: "गर्मी पूर्वानुमान",
        heatWarning: "दोपहर 2 बजे से पहले छाया",
        communityFeed: "समुदाय फीड",
        farmB: "फार्म B (1.2 किमी)",
        farmBMessage: "उच्च अलर्ट - सफेद मक्खी",
        farmC: "फार्म C (2.8 किमी)",
        farmCMessage: "नीम तेल सफल - 70% कमी",
        systemStatus: "सिस्टम स्थिति",
        online: "ऑनलाइन",
        connected: "जुड़ा हुआ",
        peers: "पीयर्स",
        poweredBy: "इको ब्लूम द्वारा",
        riskHigh: "उच्च जोखिम",
        riskMedium: "मध्यम जोखिम",
        riskLow: "कम जोखिम",
        riskTextHigh: "स्कोर: 78/100 - तत्काल",
        riskTextMedium: "स्कोर: 45/100 - निगरानी",
        riskTextLow: "स्कोर: 20/100 - सामान्य"
      }
    };

    let currentLang = 'en';

    function switchLanguage(lang) {
      currentLang = lang;
      
      ['en', 'ar', 'hi'].forEach(l => {
        const btn = document.getElementById(`lang-${l}`);
        if (l === lang) {
          btn.classList.add('bg-white', 'shadow-md');
          btn.classList.remove('hover:bg-white');
        } else {
          btn.classList.remove('bg-white', 'shadow-md');
          btn.classList.add('hover:bg-white');
        }
      });

      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang][key]) {
          el.textContent = translations[lang][key];
        }
      });

      updateRiskLevel();
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    }

    function updateRiskLevel() {
      const riskScore = 78;
      const riskLevel = document.getElementById("riskLevel");
      const riskText = document.getElementById("riskText");
      
      if (riskScore >= 70) {
        riskLevel.textContent = translations[currentLang].riskHigh;
        riskText.textContent = translations[currentLang].riskTextHigh;
      } else if (riskScore >= 40) {
        riskLevel.textContent = translations[currentLang].riskMedium;
        riskText.textContent = translations[currentLang].riskTextMedium;
      } else {
        riskLevel.textContent = translations[currentLang].riskLow;
        riskText.textContent = translations[currentLang].riskTextLow;
      }
    }

    function updateTime() {
      const now = new Date();
      document.getElementById("time").textContent = now.toLocaleTimeString([], {hour: "2-digit", minute:"2-digit"});
    }
    setInterval(updateTime, 1000);
    updateTime();

    const riskScore = 78;
    const banner = document.getElementById("riskBanner");
    const riskBar = document.getElementById("riskBar");
    const riskIcon = document.getElementById("riskIcon");
    const riskButton = document.getElementById("riskButton");

    if (riskScore >= 70) {
      banner.classList.add("bg-red-50","border-red-500");
      riskBar.classList.add("bg-red-500");
      riskBar.style.width = riskScore + "%";
      riskButton.classList.add("bg-red-500");
      riskIcon.textContent = "🚨";
    } else if (riskScore >= 40) {
      banner.classList.add("bg-yellow-50","border-yellow-500");
      riskBar.classList.add("bg-yellow-500");
      riskBar.style.width = riskScore + "%";
      riskButton.classList.add("bg-yellow-500");
      riskIcon.textContent = "⚠️";
    } else {
      banner.classList.add("bg-green-50","border-green-500");
      riskBar.classList.add("bg-green-500");
      riskBar.style.width = riskScore + "%";
      riskButton.classList.add("bg-green-500");
      riskIcon.textContent = "✅";
    }

    updateRiskLevel();

    const pestHistory = [
      {day:"Mon",count:3},{day:"Tue",count:4},{day:"Wed",count:5},
      {day:"Thu",count:7},{day:"Fri",count:9},{day:"Sat",count:12},{day:"Today",count:14}
    ];
    new Chart(document.getElementById("pestChart"), {
      type: "line",
      data: {
        labels: pestHistory.map(d => d.day),
        datasets: [{
          label:"Pests Detected",
          data: pestHistory.map(d => d.count),
          borderColor:"#dc2626",
          backgroundColor:"rgba(220, 38, 38, 0.1)",
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointRadius: 5,
          pointHoverRadius: 8,
          pointBackgroundColor: "#dc2626"
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    const weatherForecast = [
      {time:"12PM",temp:28},{time:"2PM",temp:32},{time:"4PM",temp:36},{time:"6PM",temp:38},{time:"8PM",temp:34}
    ];
    new Chart(document.getElementById("heatChart"), {
      type: "line",
      data: {
        labels: weatherForecast.map(d => d.time),
        datasets: [{
          label:"Temperature (°C)",
          data: weatherForecast.map(d => d.temp),
          borderColor:"#f97316",
          backgroundColor:"rgba(249, 115, 22, 0.1)",
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointRadius: 5,
          pointHoverRadius: 8,
          pointBackgroundColor: "#f97316"
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: { 
            beginAtZero: false,
            min: 25,
            max: 40
          }
        }
      }
    });

    // Fetch summary from Flask backend
    async function loadSummary() {
      try {
        const res = await fetch('/api/summary');
        const data = await res.json();
        document.getElementById('connectedPeers').textContent = data.connected_peers || 0;
        document.getElementById('pestCount').textContent = (Math.floor(Math.random() * 20) + 5);
      } catch (e) {
        console.warn('Could not load summary', e);
      }
    }

    loadSummary();

    function openInModal(path) {
      const modal = document.getElementById('embedModal');
      const iframe = document.getElementById('modalIframe');
      const title = document.getElementById('modalTitle');
      const openNew = document.getElementById('openNewTab');
      iframe.src = path;
      title.textContent = path === '/p2p' ? 'P2P Network' : path === '/pest' ? 'Pest Detection' : 'Heat Stress';
      openNew.href = path;
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    function closeModal() {
      const modal = document.getElementById('embedModal');
      const iframe = document.getElementById('modalIframe');
      iframe.src = '';
      modal.classList.remove('flex');
      modal.classList.add('hidden');
    }

    // Close modal on Esc
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });
  </script>
</body>
</html>