<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoBloom - Sustainable Pest Monitoring</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e5631 0%, #2d7a4a 50%, #56ab6f 100%);
            color: #2c3e2c;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, #f4f9f4 0%, #e8f5e8 100%);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            text-align: center;
            border-left: 8px solid #2d7a4a;
        }

        .un-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .un-colors {
            display: flex;
            gap: 3px;
        }

        .un-bar {
            width: 4px;
            height: 40px;
            background: #009edb;
        }

        h1 {
            color: #1e5631;
            font-size: 2.8em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            color: #2d7a4a;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .sdg-badge {
            display: inline-block;
            background: #4c9f38;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-top: 10px;
            font-weight: 600;
        }

        .language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2d7a4a 0%, #4c9f38 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .language-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(45, 122, 74, 0.4);
        }

        .rtl {
            direction: rtl;
            text-align: right;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #ffffff 0%, #f9fdf9 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            border-left: 5px solid #56ab6f;
        }

        .card h2 {
            color: #1e5631;
            margin-bottom: 15px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            font-size: 1.3em;
        }

        .stat {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .stat:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #666;
        }

        .stat-value {
            font-weight: bold;
            color: #333;
        }

        .risk-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .risk-low {
            background: #d4edda;
            color: #155724;
        }

        .risk-medium {
            background: #fff3cd;
            color: #856404;
        }

        .risk-high {
            background: #f8d7da;
            color: #721c24;
        }

        .camera-list {
            list-style: none;
        }

        .camera-item {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4ead4 100%);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid #4c9f38;
        }

        .camera-item:hover {
            background: linear-gradient(135deg, #d4ead4 0%, #c0e0c0 100%);
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(76, 159, 56, 0.3);
        }

        .camera-name {
            font-weight: bold;
            color: #1e5631;
            margin-bottom: 5px;
        }

        .camera-info {
            font-size: 0.9em;
            color: #666;
        }

        button {
            background: linear-gradient(135deg, #2d7a4a 0%, #4c9f38 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            margin: 5px;
            font-weight: 600;
        }

        button:hover {
            background: linear-gradient(135deg, #1e5631 0%, #2d7a4a 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(45, 122, 74, 0.4);
        }

        .detection-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .detection-item {
            background: linear-gradient(135deg, #f9fdf9 0%, #f0f8f0 100%);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #4c9f38;
        }

        .detection-time {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .chart-container {
            height: 300px;
            margin-top: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2em;
        }

        .auto-capture-info {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4ead4 100%);
            border: 2px solid #4c9f38;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }

        .auto-capture-info h3 {
            color: #1e5631;
            margin-bottom: 10px;
        }

        .auto-capture-info p {
            color: #2d7a4a;
            line-height: 1.6;
        }

        .alert-item {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <button class="language-toggle" onclick="toggleLanguage()">
        <span id="langButton">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
    </button>

    <div class="container">
        <header>
            <div class="un-logo">
                <div class="un-colors">
                    <div class="un-bar"></div>
                    <div class="un-bar"></div>
                    <div class="un-bar"></div>
                </div>
                <h1 data-en="EcoBloom" data-ar="ÿ•ŸäŸÉŸà ÿ®ŸÑŸàŸÖ">EcoBloom</h1>
            </div>
            <p class="subtitle" data-en="Sustainable Pest Monitoring for Climate-Smart Agriculture" data-ar="ŸÖÿ±ÿßŸÇÿ®ÿ© ŸÖÿ≥ÿ™ÿØÿßŸÖÿ© ŸÑŸÑÿ¢ŸÅÿßÿ™ ŸÖŸÜ ÿ£ÿ¨ŸÑ ÿ≤ÿ±ÿßÿπÿ© ÿ∞ŸÉŸäÿ© ŸÖŸÜÿßÿÆŸäÿßŸã">Sustainable Pest Monitoring for Climate-Smart Agriculture</p>
            <div class="sdg-badge" data-en="UN SDG 2: Zero Hunger | SDG 13: Climate Action" data-ar="ÿ£ŸáÿØÿßŸÅ ÿßŸÑÿ£ŸÖŸÖ ÿßŸÑŸÖÿ™ÿ≠ÿØÿ© ŸÑŸÑÿ™ŸÜŸÖŸäÿ© ÿßŸÑŸÖÿ≥ÿ™ÿØÿßŸÖÿ© 2: ÿßŸÑŸÇÿ∂ÿßÿ° ÿπŸÑŸâ ÿßŸÑÿ¨Ÿàÿπ | 13: ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖŸÜÿßÿÆŸä">UN SDG 2: Zero Hunger | SDG 13: Climate Action</div>
        </header>

        <!-- Summary Statistics -->
        <div class="grid">
            <div class="card">
                <h2><span class="icon">üìä</span> <span data-en="Overall Statistics (7 Days)" data-ar="ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿπÿßŸÖÿ© (7 ÿ£ŸäÿßŸÖ)">Overall Statistics (7 Days)</span></h2>
                <div id="overallStats" class="loading" data-en="Loading..." data-ar="ÿ¨ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...">Loading...</div>
            </div>

            <div class="card">
                <h2><span class="icon">üåç</span> <span data-en="Active Farm Locations" data-ar="ŸÖŸàÿßŸÇÿπ ÿßŸÑŸÖÿ≤ÿßÿ±ÿπ ÿßŸÑŸÜÿ¥ÿ∑ÿ©">Active Farm Locations</span></h2>
                <div id="cameraList" class="loading" data-en="Loading..." data-ar="ÿ¨ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...">Loading...</div>
            </div>

            <div class="card">
                <h2><span class="icon">‚ö†Ô∏è</span> <span data-en="Recent Alerts" data-ar="ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿ≠ÿØŸäÿ´ÿ©">Recent Alerts</span></h2>
                <div id="alertsList" class="loading" data-en="Loading..." data-ar="ÿ¨ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...">Loading...</div>
            </div>
        </div>

        <!-- Automated System Info -->
        <div class="card">
            <h2><span class="icon">ü§ñ</span> <span data-en="Automated Monitoring System" data-ar="ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿ±ÿßŸÇÿ®ÿ© ÿßŸÑÿ¢ŸÑŸä">Automated Monitoring System</span></h2>
            <div class="auto-capture-info">
                <h3 data-en="IoT Camera Traps - Continuous Field Monitoring" data-ar="ŸÅÿÆÿßÿÆ ŸÉÿßŸÖŸäÿ±ÿß ÿ•ŸÜÿ™ÿ±ŸÜÿ™ ÿßŸÑÿ£ÿ¥Ÿäÿßÿ° - ŸÖÿ±ÿßŸÇÿ®ÿ© ŸÖÿ≥ÿ™ŸÖÿ±ÿ© ŸÑŸÑÿ≠ŸÇŸàŸÑ">IoT Camera Traps - Continuous Field Monitoring</h3>
                <p data-en="Raspberry Pi cameras automatically capture sticky trap images every hour. Images are analyzed using computer vision and results are logged to the database. Farmers receive instant alerts when pest levels reach concerning thresholds." data-ar="ÿ™ŸÑÿ™ŸÇÿ∑ ŸÉÿßŸÖŸäÿ±ÿßÿ™ ÿ±ÿßÿ≥ÿ®Ÿäÿ±Ÿä ÿ®ÿßŸä ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿµŸàÿ± ÿßŸÑŸÅÿÆÿßÿÆ ÿßŸÑŸÑÿßÿµŸÇÿ© ŸÉŸÑ ÿ≥ÿßÿπÿ©. Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿµŸàÿ± ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ±ÿ§Ÿäÿ© ÿßŸÑŸÉŸÖÿ®ŸäŸàÿ™ÿ± Ÿàÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. Ÿäÿ™ŸÑŸÇŸâ ÿßŸÑŸÖÿ≤ÿßÿ±ÿπŸàŸÜ ÿ™ŸÜÿ®ŸäŸáÿßÿ™ ŸÅŸàÿ±Ÿäÿ© ÿπŸÜÿØŸÖÿß ÿ™ÿµŸÑ ŸÖÿ≥ÿ™ŸàŸäÿßÿ™ ÿßŸÑÿ¢ŸÅÿßÿ™ ÿ•ŸÑŸâ ÿπÿ™ÿ®ÿßÿ™ ŸÖŸÇŸÑŸÇÿ©.">
                    Raspberry Pi cameras automatically capture sticky trap images every hour. Images are analyzed using computer vision and results are logged to the database. Farmers receive instant alerts when pest levels reach concerning thresholds.
                </p>
                <p style="margin-top: 15px; font-size: 0.95em;" data-en="Sustainable Technology: Solar-powered devices | Low environmental impact | Community-driven data" data-ar="ÿ™ŸÉŸÜŸàŸÑŸàÿ¨Ÿäÿß ŸÖÿ≥ÿ™ÿØÿßŸÖÿ©: ÿ£ÿ¨Ÿáÿ≤ÿ© ÿ™ÿπŸÖŸÑ ÿ®ÿßŸÑÿ∑ÿßŸÇÿ© ÿßŸÑÿ¥ŸÖÿ≥Ÿäÿ© | ÿ™ÿ£ÿ´Ÿäÿ± ÿ®Ÿäÿ¶Ÿä ŸÖŸÜÿÆŸÅÿ∂ | ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿØŸÅŸàÿπÿ© ŸÖŸÜ ÿßŸÑŸÖÿ¨ÿ™ŸÖÿπ">
                    <strong>Sustainable Technology:</strong> Solar-powered devices | Low environmental impact | Community-driven data
                </p>
            </div>
            <button onclick="triggerManualCapture()"><span data-en="üîÑ Trigger Manual Camera Capture" data-ar="üîÑ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ™ŸÇÿßÿ∑ ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß ŸäÿØŸàŸäÿßŸã">üîÑ Trigger Manual Camera Capture</span></button>
        </div>

        <!-- Recent Detections -->
        <div class="card">
            <h2><span class="icon">üîç</span> <span data-en="Recent Detections (Last 24 Hours)" data-ar="ÿßŸÑŸÉÿ¥ŸàŸÅÿßÿ™ ÿßŸÑÿ£ÿÆŸäÿ±ÿ© (ÿ¢ÿÆÿ± 24 ÿ≥ÿßÿπÿ©)">Recent Detections (Last 24 Hours)</span></h2>
            <div id="recentDetections" class="detection-list loading" data-en="Loading..." data-ar="ÿ¨ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...">Loading...</div>
        </div>

        <!-- Trend Chart -->
        <div class="card">
            <h2><span class="icon">üìà</span> <span data-en="Pest Activity Trend" data-ar="ÿßÿ™ÿ¨ÿßŸá ŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ¢ŸÅÿßÿ™">Pest Activity Trend</span></h2>
            <div id="trendChart">
                <canvas id="chartCanvas" width="800" height="300"></canvas>
            </div>
        </div>

        <!-- Footer -->
        <footer style="text-align: center; margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; color: #e8f5e8;">
            <p style="font-size: 0.9em;" data-en="üå± Built for Reboot Earth Hackathon 2025 | Sustainable Agriculture Technology" data-ar="üå± ŸÖÿ®ŸÜŸä ŸÑŸáÿßŸÉÿßÿ´ŸàŸÜ ÿ±Ÿäÿ®Ÿàÿ™ ÿ•Ÿäÿ±ÿ´ 2025 | ÿ™ŸÉŸÜŸàŸÑŸàÿ¨Ÿäÿß ÿßŸÑÿ≤ÿ±ÿßÿπÿ© ÿßŸÑŸÖÿ≥ÿ™ÿØÿßŸÖÿ©">üå± Built for Reboot Earth Hackathon 2025 | Sustainable Agriculture Technology</p>
            <p style="font-size: 0.85em; margin-top: 10px;" data-en="Supporting UN Sustainable Development Goals: Zero Hunger, Climate Action, Sustainable Communities" data-ar="ÿØÿπŸÖ ÿ£ŸáÿØÿßŸÅ ÿßŸÑÿ£ŸÖŸÖ ÿßŸÑŸÖÿ™ÿ≠ÿØÿ© ŸÑŸÑÿ™ŸÜŸÖŸäÿ© ÿßŸÑŸÖÿ≥ÿ™ÿØÿßŸÖÿ©: ÿßŸÑŸÇÿ∂ÿßÿ° ÿπŸÑŸâ ÿßŸÑÿ¨Ÿàÿπÿå ÿßŸÑÿπŸÖŸÑ ÿßŸÑŸÖŸÜÿßÿÆŸäÿå ÿßŸÑŸÖÿ¨ÿ™ŸÖÿπÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿØÿßŸÖÿ©">Supporting UN Sustainable Development Goals: Zero Hunger, Climate Action, Sustainable Communities</p>
        </footer>
    </div>

    <script>
        // Language toggle
        let currentLang = 'en';

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ar' : 'en';

            // Update all translatable elements
            document.querySelectorAll('[data-en][data-ar]').forEach(elem => {
                elem.textContent = elem.getAttribute('data-' + currentLang);
            });

            // Toggle RTL
            if (currentLang === 'ar') {
                document.body.classList.add('rtl');
                document.getElementById('langButton').textContent = 'English';
            } else {
                document.body.classList.remove('rtl');
                document.getElementById('langButton').textContent = 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©';
            }

            // Reload dashboard data with new language
            loadDashboard();
        }

        // API calls
        async function fetchData(endpoint) {
            try {
                const response = await fetch(`/api/${endpoint}`);
                return await response.json();
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        async function loadDashboard() {
            // Load overall statistics
            const stats = await fetchData('statistics?days=7');
            if (stats) {
                document.getElementById('overallStats').innerHTML = `
                    <div class="stat">
                        <span class="stat-label">Total Captures:</span>
                        <span class="stat-value">${stats.total_captures || 0}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Total Pests Detected:</span>
                        <span class="stat-value">${stats.total_pests || 0}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Average per Capture:</span>
                        <span class="stat-value">${(stats.avg_pests || 0).toFixed(1)}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Maximum in Single Capture:</span>
                        <span class="stat-value">${stats.max_pests || 0}</span>
                    </div>
                `;
            }

            // Load cameras
            const cameras = await fetchData('cameras');
            if (cameras && cameras.length > 0) {
                document.getElementById('cameraList').innerHTML = `
                    <ul class="camera-list">
                        ${cameras.map(cam => `
                            <li class="camera-item" onclick="showCameraDetails('${cam.camera_id}')">
                                <div class="camera-name">${cam.camera_id}</div>
                                <div class="camera-info">${cam.location_name}</div>
                                <div class="camera-info">Last capture: ${new Date(cam.last_capture).toLocaleString()}</div>
                                <div class="camera-info">Total: ${cam.total_captures} captures</div>
                            </li>
                        `).join('')}
                    </ul>
                `;
            } else {
                document.getElementById('cameraList').innerHTML = '<p>No cameras registered yet</p>';
            }

            // Load alerts
            const alerts = await fetchData('alerts/pending');
            if (alerts && alerts.length > 0) {
                document.getElementById('alertsList').innerHTML = alerts.slice(0, 5).map(alert => `
                    <div class="alert-item">
                        <strong>${alert.alert_type}</strong><br>
                        ${alert.message}<br>
                        <small>${new Date(alert.timestamp).toLocaleString()}</small>
                    </div>
                `).join('');
            } else {
                document.getElementById('alertsList').innerHTML = '<p>No pending alerts üéâ</p>';
            }

            // Load recent detections
            const detections = await fetchData('detections/recent?hours=24&limit=20');
            if (detections && detections.length > 0) {
                document.getElementById('recentDetections').innerHTML = detections.map(det => `
                    <div class="detection-item">
                        <div class="detection-time">${new Date(det.timestamp).toLocaleString()}</div>
                        <strong>${det.camera_id}</strong> - ${det.location_name}<br>
                        Pests: <strong>${det.pest_count}</strong> |
                        Risk: <span class="risk-badge risk-${det.risk_level.toLowerCase()}">${det.risk_level}</span>
                    </div>
                `).join('');
            } else {
                document.getElementById('recentDetections').innerHTML = '<p>No detections in the last 24 hours</p>';
            }

            // Load trend data and draw simple chart
            const trends = await fetchData('trends?days=7');
            if (trends && trends.length > 0) {
                drawTrendChart(trends);
            }
        }

        function drawTrendChart(trends) {
            const canvas = document.getElementById('chartCanvas');
            const ctx = canvas.getContext('2d');

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Get max value for scaling
            const maxPests = Math.max(...trends.map(t => t.total_pests || 0));
            const padding = 50;
            const graphHeight = canvas.height - 2 * padding;
            const graphWidth = canvas.width - 2 * padding;
            const stepX = graphWidth / (trends.length - 1 || 1);

            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();

            // Draw line
            ctx.strokeStyle = '#2d7a4a';
            ctx.lineWidth = 3;
            ctx.beginPath();

            trends.forEach((trend, i) => {
                const x = padding + i * stepX;
                const y = canvas.height - padding - (trend.total_pests / (maxPests || 1)) * graphHeight;

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }

                // Draw data points
                ctx.fillStyle = '#4c9f38';
                ctx.fillRect(x - 3, y - 3, 6, 6);
            });

            ctx.stroke();

            // Draw labels
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';

            trends.forEach((trend, i) => {
                const x = padding + i * stepX;
                const date = new Date(trend.date);
                const label = `${date.getMonth() + 1}/${date.getDate()}`;
                ctx.fillText(label, x, canvas.height - padding + 20);
            });
        }

        function showCameraDetails(cameraId) {
            alert(`Camera: ${cameraId}\n\nDetailed view coming soon!`);
        }


        async function triggerManualCapture() {
            if (!confirm('Trigger a manual camera capture and analysis?')) return;

            try {
                const response = await fetch('/api/manual-capture', {
                    method: 'POST'
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ Manual capture successful!\n\nPests: ' + result.result.pest_count + '\nRisk: ' + result.result.risk_level);
                    loadDashboard();
                } else {
                    alert('‚ùå Capture failed: ' + result.error);
                }
            } catch (error) {
                alert('‚ùå Error triggering capture');
            }
        }

        // Load dashboard on page load
        loadDashboard();

        // Refresh every 30 seconds
        setInterval(loadDashboard, 30000);
    </script>
</body>
</html>
